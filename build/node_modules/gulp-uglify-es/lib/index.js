"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var o_stream_1 = require("o-stream");
var Uglify = require("uglify-es");
// const gulpExec: () => Transform = require("gulp-exec");
// let execUglifyOption = { continueOnError: false, pipeStdout: true };
// let uglify = gulpExec.bind(null,
// "call ./node_modules/.bin/uglifyjs \"<%= file.path %>\"", execUglifyOption);
function plugin(options) {
    // let result = uglify();
    // result.on('error', function (err: any) {
    //     gutil.log(gutil.colors.red('[Error]'), err.toString());
    //     this.emit('end');
    // });
    // return result;
    return o_stream_1.default.transform({
        onEntered: function (args) {
            var result = Uglify.minify(args.object.contents.toString(), options);
            if (result.error) {
                throw result.error;
            }
            args.object.contents = new Buffer(result.code);
            args.output.push(args.object);
        }
    });
}
exports.default = plugin;
